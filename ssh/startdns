#!/usr/bin/env bash
# Start Simple SlowDNS - SINNOMBRE22

clear

# ==================================================
# üìå COLORES OFICIALES
# ==================================================
R='\033[0;31m'; G='\033[0;32m'; Y='\033[1;33m'
W='\033[1;37m'; CYAN='\033[0;36m'; RESET='\033[0m'
BOLD='\033[1m'
ROJO="\e[31m"; BLANCO="\e[97m"

# ==================================================
# üìå L√çNEA OFICIAL
# ==================================================
LINEA="${ROJO}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê / / / ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${RESET}"

# ==================================================
# üìå BARRA OFICIAL
# ==================================================
barra_progreso() {
comando="$1"
(
[[ -e $HOME/fim ]] && rm $HOME/fim
$comando > /dev/null 2>&1
touch $HOME/fim
) > /dev/null 2>&1 &

tput civis
echo -ne "${CYAN}ESPERANDO ${ROJO}["
while true; do
   for((i=0; i<18; i++)); do
      echo -ne "#"
      sleep 0.08
   done
   [[ -e $HOME/fim ]] && rm $HOME/fim && break
   echo -e "]"
   sleep 1
   tput cuu1
   tput dl1
   echo -ne "${CYAN}ESPERANDO ${ROJO}["
done
echo -e "] ${G}OK${RESET}"
tput cnorm
}

# ==================================================
# üìå T√çTULO
# ==================================================
echo -e "$LINEA"
echo -e "${BOLD}${BLANCO}                INICIANDO SLOWDNS                ${RESET}"
echo -e "$LINEA"

# ==================================================
# FUNCI√ìN START
# ==================================================
fun_start() {

# Verificar si ya est√° activo
if pgrep -f dns-server > /dev/null; then
    echo -e "${Y}‚ö† SlowDNS ya est√° en ejecuci√≥n${RESET}"
    sleep 2
    return
fi

cd /etc/slowdns || exit 1

screen -dmS slowdns ./dns-server -udp :5300 \
-privkey-file /root/server.key \
1234 127.0.0.1:22

sleep 2
}

# ==================================================
# EJECUTAR
# ==================================================
barra_progreso fun_start

echo
echo -e "${G}‚úî SlowDNS iniciado correctamente${RESET}"
echo
read -p "Presiona ENTER para continuar..."

slowdns