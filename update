#!/bin/bash

clear

# =============================
# COLORES
# =============================
R='\033[0;31m'; G='\033[0;32m'; Y='\033[1;33m'; B='\033[0;34m'
M='\033[0;35m'; C='\033[0;36m'; W='\033[1;37m'; N='\033[0m'
BOLD='\033[1m'
ROJO="\e[31m"; BLANCO="\e[97m"; CYAN="\e[36m"; AMARILLO="\e[33m"; RESET="\e[0m"

LINEA="${ROJO}══════════════════════════ / / / ══════════════════════════${RESET}"

# =============================
# BARRA DE PROGRESO
# =============================
fun_bar() {
    (
        $1 > /dev/null 2>&1
        touch $HOME/fim
    ) &

    tput civis
    echo -ne "  ${CYAN}ESPERANDO${RESET} ${ROJO}["
    while true; do
        for ((i=0; i<18; i++)); do
            echo -ne "${ROJO}#${RESET}"
            sleep 0.1
        done
        [[ -e $HOME/fim ]] && rm $HOME/fim && break
        echo -ne "${ROJO}]${RESET}"
        sleep 1
        tput cuu1
        tput dl1
        echo -ne "  ${CYAN}ESPERANDO${RESET} ${ROJO}["
    done
    echo -e "${ROJO}]${RESET} ${G}OK${RESET}"
    tput cnorm
}

# =============================
# AVISO
# =============================
echo -e "$LINEA"
echo -e "${BOLD}${BLANCO}        ATENCIÓN IMPORTANTE${RESET}"
echo -e "$LINEA"
echo ""
echo -e "${AMARILLO}Al finalizar el proceso deberás${RESET}"
echo -e "${AMARILLO}configurar nuevamente el servicio SlowDNS.${RESET}"
echo ""
echo -e "${CYAN}Selecciona la opción:${RESET}"
echo -e "${G}'Usar clave actual'${RESET} ${CYAN}para restaurar tu clave anterior.${RESET}"
echo ""
echo -e "$LINEA"
read -p "Presiona [ENTER] para continuar o CTRL + C para cancelar"

clear
echo -e "$LINEA"
echo -e "${ROJO}ELIMINANDO ARCHIVOS ANTIGUOS...${RESET}"
echo -e "$LINEA"
echo ""

# =============================
# ELIMINAR INSTALACIÓN ANTERIOR
# =============================
fun_remove() {

    cd /root || exit 1

    wget -q https://raw.githubusercontent.com/SINNOMBRE22/dnstt/main/remove-slow -O remove-slow
    chmod +x remove-slow
    bash remove-slow

    sleep 2

    rm -f /bin/slowdns
    rm -rf /etc/slowdns
    rm -f /root/remove-slow
}

fun_bar fun_remove

echo ""
echo -e "$LINEA"
echo -e "${Y}ACTUALIZANDO SCRIPT...${RESET}"
echo -e "$LINEA"
echo ""

# =============================
# DESCARGAR NUEVA VERSIÓN
# =============================
fun_update() {

    cd /root || exit 1

    wget -q https://raw.githubusercontent.com/SINNOMBRE22/dnstt/main/install -O install
    chmod +x install
    bash install
}

fun_bar fun_update

sleep 2

echo ""
echo -e "$LINEA"
echo -e "${G}✔ SLOWDNS ACTUALIZADO CORRECTAMENTE${RESET}"
echo -e "$LINEA"
echo ""
echo -e "${CYAN}Para abrir el menú usa el comando:${RESET}"
echo ""
echo -e "   ${BOLD}${BLANCO}slowdns${RESET}"
echo ""
echo -e "$LINEA"
read -p "Presiona [ENTER] para finalizar..."